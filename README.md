# BUAASE2024-团队项目-版本控制

> 此README.md为此次版本控制作业的要求文档，包含了作业的**具体要求和任务列表**。
> **Contribute.md 为项目开发规范，请大家认真阅读**。
> **Git_learn.md 中是和Git相关的操作，请不熟悉同学及时补习**。

> “Your organization’s codebase is sustainable when you are able to change all of the things that you ought to change, safely, and can do so for the life of your codebase.”
>
> ——[Software Engineering at Google](https://abseil.io/resources/swe-book/html/toc.html), Titus Winters, Tom Manshreck and Hyrum Wright

课程的团队课设最终要求大家交付一个完整可用的**软件系统**。时长两个月的团队开发中，我们将时时对团队**最重要的资产**——**代码库**进行修改、迭代和完善。因此，保障它**稳定、安全、可持续地存在**，并能够**稳健地持续合并来自每个成员的变更、扩展和迭代**是重要的。

我们可以采用无数种可能方式来管理这一资产：基于群文件分享代码压缩包会得到助教组充满敬意的赞👍、邮寄代码的完整纸质副本会在这门课程的历史上留下足够先锋的脚印👣......但如果你也一样，对 `软工课堂展示-Pre-Draft5By熊-ffffffinal最终版真的绝对不再改了.pptx` 这样的文件名抱持与生俱来的恐惧、又或是憧憬无纸化办公的环保主义者，那么在团队开发中引入版本控制系统（Version Control System, VCS），绝对是值得的投资——事实上，也是当下软件工程领域明确的共识。

> **软件工程是随着时间的推移而集成的编程......开发本质上是一个分支和合并的过程，无论是在多个开发人员之间还是在不同时间点的单个开发人员之间进行协调。**

多人、长时的开发流程，需要正式的版本控制系统来管理源代码、协调工程师之间的活动。团队开发的过程中我们会自然地产生如下需要：

- 追踪工作的最新进度和历史进展；
- 并行地进行工作，提交更改；
- 合并修改、跟踪合并；
- ......

为了支撑这些需要，除了将 VCS 集成进我们的工作流程之外，我们还需有一套共识性的规范来指导对 VCS 的使用——团队开发中对代码库负责的不是**某一个人**，而是**每一个人**。

在这篇 Guide 里我们将一起通过一次团队的实践，认识版本控制系统在集体开发中的具体做法，并对形成行之有效的协作规范有所见解。

版本控制系统的选择有很多，你可在[这里](https://zh.wikipedia.org/wiki/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6)进一步了解。这篇 Guide 基于目前最流行、也是大家最可能选用的分布式版本控制系统 Git 设计。

## 需要做什么？

**附录 A** 提供了一个软件工程小组的 Git 规范。接下来会给定一些任务，请依据指引遵照这份规范来进行代码修改和 Git 操作。

请注意，这份 Git 规范并不是团队开发的**最佳实践**，在不同的情形下、不同的团队中需要针对各类因素来设计适用的规范和工作流。我们基于这样一个目标采用了这份规范并设计了这次作业：涵盖团队开发阶段使用版本控制系统时可能遇到的常见场景和具体问题，从而让大家对这些问题有基本的认识、进而制定和协调最适用于各自团队的工作流。

**助教组会根据 commit 记录等仓库遗留的操作记录检查每个团队的完成情况。**

请保留全部的操作记录，包括分支、issue、pr 等。

当你的操作出现不致命的小差错、与“规范”相悖时，不用担心，这些无心之过可以原样保留在操作历史里。但是，“觉得自己搞砸了”的情形下，希望你能在代码仓库根目录下的 `error-logs.txt` 中留下你对错误的记录。

如果出现团队成员误操作、导致难以还原的情况，请首先了解可能的恢复方式、或在课程群中讨论有关做法，在完全无果的情况下可以重新开始。再次提醒大家：团队开发中对代码库负责的不是**某一个人**，而是**每一个人**，请<u>**谨慎地对待这份团队最重要的资产**</u>。这些情况，需要在作业提交时记录。

助教组可能会根据记录情况询问团队相关问题。

## 任务列表

请按照顺序完成各组任务。同组内无序列表标注的任务没有严格的顺序。

标记为 `🚧Maintenance` 的任务请团队中的**特定成员**负责，通常可以由小组中的 DevOps 岗完成——当然，也可以分配工作给某几位同学一起完成；

标记为 `🧑‍💻Every` 的任务请团队中的**每一位成员**参与；

标记为 `🚩Team` 的任务请团队将列表中的任务分配给各位成员完成，**每位成员至少完成一项、一个任务只能分配给一个人完成**。

### PRE. 团队的准备

#### `🧑‍💻Every` 团队协作的事前讨论

1. 请大家在一起讨论对于 DevOps 的理解，分配本团队的 DevOps 相关工作。操作上，也可以由团队决定一位同学来担当全部相关工作。
2. 请大家调研并根据小组内的网络环境、使用习惯等因素决定 DevOps 的各项考虑和服务选型，也可以使用一体化的 DevOps 平台例如[腾讯云 CODING](https://coding.net/). 至少，需要决定一款代码托管平台。**对于这次作业**，请在 [GitHub](https://github.com/) 或 [GitCode](https://gitcode.net/) 中二选一完成。 
3. 选择好之后，请各位成员在相关平台上完成账户注册、创建组织等工作。请注意，本次作业的代码仓库需要保证**至少课程组内部可以自由访问**以保证公正性；除非特殊情况，建议保持公开。

#### `🚧Maintenance` 初始化代码仓库

1. `Fork`（或在使用其他平台时 `Clone`）[GitHub 仓库](https://github.com/kuma-xx/BUAASE2024-TeamVersionControl) 或 [GitCode 仓库](https://gitcode.net/CodingNoBorder/buaase2024-teamversioncontrol)，初始化本团队的仓库；
2. 设置代码仓库中成员的相关权限；
3. 建立一个 `dev` 分支；
4. 检出分支 `chore/init`；
5. 在根目录下创建一个 `.gitignore` 文件，忽略根目录下的 `info.txt` 文件；
6. 在根目录下创建一个 `error-logs.txt` 文件；
7. 为仓库设置 Issue 模板，你可以参照 [GitHub 教程](https://docs.github.com/zh/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository)，或 [GitCode 教程](https://gitcode.net/gitcode/help-docs/-/wikis/docs/user/project/description-template)；
8. 提交更改，按照合并规范操作，最终合并你的更改到 `dev` 分支；
9. 通知团队的所有成员现在可以开始进入下一个阶段 `Task.1` 了。

### Task.1 

#### `🧑‍💻Every` 自我介绍！

1. 每位成员：拉取代码仓库到本地；

2. 在根目录下新建一个 `info.txt` 文件，向其中添加如下信息：

   ```
   name: <你的用户名>
   description: <你的一句话自我介绍>
   ```

   请注意不要包含太敏感的个人信息。

#### `🚩Team` 各写各的！

1. 接下来的任务，模拟开发中的各种情形，所有操作在 `/src` 下完成。提醒：**请注意分支和提交规范**。

2. 请认领如下任务中的至少一项：

   - 新建文件 `frontend.json`，格式如下：

     ```json
     {
         "data": [
             {
                 "name": "<名称>",
                 "link": "<链接>"
             },
                 ...
         ]
     }
     ```

     列举至少三个你所了解的前端框架。

   - 新建文件 `backend.json`，格式如下：

     ```json
     {
         "data": [
             {
                 "name": "<名称>",
                 "link": "<链接>"
             },
             	...
         ]
     }
     ```

     列举至少三个你所了解的后端框架。

   - 新建文件 `midend.json`，格式如下：

     ```json
     {
         "data": [
             {
                 "content": "<内容>",
                 "language": "<语言>"
             },
             	...
         ]
     }
     ```

     列举至少两条你所了解的双关 / 谐音冷笑话。

   - 修改文件 `tga-awards-2023.json`，文件内记录了几项 2023 年度 TGA 大奖的[获奖作品](https://thegameawards.com/nominees/game-of-the-year)，其中有两项似乎记载错误。**这是一个 BUG**，请按照 `Bug 提出与修复` 的规范进行修复。如果获奖结果和你的喜好不一致，你也可以声称某一项是 **Bug** 并修改为你喜欢的。

   - 修改文件 `golden-melody-awards.json`，文件内记录了近些年金曲奖的年度专辑奖获奖信息，其中有一项似乎记载错误。**这是一个 BUG**，请按照 `Bug 提出与修复` 的规范进行修复。如果获奖结果和你的喜好不一致，你也可以声称某一项是 **Bug** 并修改为你喜欢的。

   - 修改文件 `anime-list.json`，文件内记录了一些数据。原本的记录方法是：

     ```json
     {
         "data": [
             {
                 "name": "<名字>",
                 "en-name": "<英文名字>"
             },
             	...
         ]
     }
     ```

     助教派来的 PM 路过瞅了一眼，拍了拍脑袋，觉得太长了，需要**重构**成如下形式：

     ```json
     {
         "data": {
             "names": ["<所有名字>"],
             "en-names": ["<所有英文名字>"]
         }
     }
     ```

     请你不跟 ta 一般见识，帮 ta 完成这个微不足道的梦想。

   - 修改文件 `really-ugly-json.json`，代码风格差强人意，请你帮忙**调整代码风格（不影响语义）**。

3. 当你完成任务后，提交更改（aka. `git commit`）；

4. 按照合并规范操作到提出 Pull Request；

5. 全员完成后进行到下一阶段。

#### `🧑‍💻Every` 第一次合并！

1. 请大家在一起讨论你们如何进行 Code Review、如何处理团队产生的 Pull Request；
2. 请大家完成本次任务中所有产生的合并，如果产生了冲突请讨论为什么会产生冲突、应该如何解决。并且讨论附录 A 中的合并规范可能出于什么原因要求采用 `git rebase`，而没有提到我们更为熟悉也一如其名的 `git merge`，这样的选择会带来什么样的问题和益处？可以参考[这篇文章](https://blog.csdn.net/kevinxxw/article/details/123980372/)来了解相关信息；
3. 请大家根据**分支规范**完成**发布前的确认**、**版本发布**和**Tag 操作**。然后，请根据你们的实践结果在一起讨论完成一次迭代后，你们如何完成代码的确认和发布。

### Task.2

#### `🚩Team` 各写各的！

1. 接下来的任务，所有操作均在 `/src/info` 下完成，其中预置文件的格式均相同：

   ```json
   {
       "username": "<用户名>",
       "data": "<数据>"
   }
   ```

   请保留格式，只修改内容;

2. 请认领如下任务中的至少一项，每位同学领取的任务不能相同，**先不要着急完成**：

   - 修改文件 `animal.json`，将内容修改为你的用户名和你最喜欢的动物，可以的话希望你只改用户名🐻；
   - 修改文件 `book.json`，将内容修改为你的用户名和你最近在看的书；
   - 修改文件 `classroom.json`，将内容修改为你的用户名和你最喜欢的教室；
   - 修改文件 `drink.json`，将内容修改为你的用户名和你最喜欢的饮料，只改用户名也没关系；
   - 修改文件 `fastfood.json`，将内容修改为你的用户名和你最喜欢的快餐食品；
   - 修改文件 `rockmusic.json`，将内容修改为你的用户名和你最喜欢的摇滚乐，如果不喜欢摇滚乐的话请填写最喜欢的音乐；
   - 修改文件 `subway.json`，将内容修改为你的用户名和你最喜欢的地铁线路，或者你最喜欢的赛百味餐点。

3. 认领好任务后，请**在此时一次检出新分支，对应你选择的一项**，命名为 `feature/type-1`，`type` 对应你选择的那项任务，例如 `feature/fastfood-1`；

4. **仍然不要开始完成任务**，回到第二步，认领你**第一次没有选择**的一项，每位同学领取的任务不能相同。然后**再次进行第三步**，这次将分支命名为 `feature/type-2`；

5. 现在可以开始完成**你所选择的第一项任务了**。请在 `feature/type-1` 分支上操作，完成修改之后，**提交一次更改（FYI, aka. `git commit`）**；然后再次修改 `<数据>` 项的内容为其他内容，**再次提交一次更改**。接下来，执行合并规范至**提交 Pull Request**。**等待，不要开始第二项任务**；

#### `🚧Maintenance` 第一项任务，完成！

1. 请按照你们团队的 Code Review 和 Pull Request 处理流程，由有仓库管理权限的成员完成第一项任务所做修改的所有合并工作；
2. 解决掉所有 Pull Request 后，请仓库管理者通知大家可以进行第二项任务了。

#### `🚩Team` 各写各的！

1. 请完成你所选择的第二项任务。请切换到 `feature/type-2` 分支，完成修改之后，提交更改，然后再执行合并规范，**如果此时你遇到了冲突，请解决每一个冲突**：如果有来自他人编辑的信息，**出于尊重请你把信息合并成**：

   ```json
   {
       "username": "<他人的用户名>, <你的用户名>",
       "data": "<他人的最新数据>, <你的数据>"
   }
   ```

   的形式；

2. 按照合并规范操作到提出 Pull Request，然后**不用再等待**，**请团队的代码管理成员 `🚧Maintenance` 尽快处理 Pull Request**，使修改合并到 `dev` 分支。

#### `🧑‍💻Every` 第二项任务，完成！

1. 请大家在一起检查最终完成的 `dev` 分支代码，是否出现了修改丢失的状况。如果有，是谁的什么操作导致的？
2. 请讨论在哪些地方遇到了冲突，如何解决，有没有意料之外的状况，应对这些状况进行了哪些操作。如果在合并 Pull Request 的阶段遇到了冲突，请讨论冲突的缘由。作为参考，可以在完成后的代码仓库下执行命令 `gitk`，对照显示的分支图进行讨论；
3. 请大家根据**分支规范**完成**发布前的确认**、**版本发布**和**Tag 操作**，发布第二次迭代后完成的版本。

### Task. HotFix!

#### `🧑‍💻Every` 超烫手的修复！

1. 请大家一起完成以下任务，或许只需要一个人来操作，但需要所有人了解操作的流程。

2. 请设想这样一个场景：在发布前检查中你们发现 `/src/tofix/classdata.json ` 存在 **Bug**：由于助教的某种疏忽，任课老师的名字打错了！请依照**分支规范**的说明，在 `release` 分支上进行修复；

3. 请设想这样一个场景：在将代码开源之前，你们突然发现 `/src/tofix/SUPER-SENSITIVE-DATA.txt` 含有某种绝密信息！而该文件（和它的信息）已经出现在远端仓库（的许多许多次提交）中了。**请先 Clone 一份你们的仓库来避免惨剧发生**，然后根据[这篇指引](https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)执行操作，将这个文件从所有提交中移除，然后**在远端新建一个代码库**，将你们完成操作的结果推送到**新的代码库**。务请注意：**这个文件是在你们开始修改前被不怀好意的助教引入的，请检查仓库中你们开始本次作业以前的各次提交，查找文件在被移动到这个位置之前还在哪里出现过，对应又该如何执行操作。**

   > 找不到也没关系啦！但请一定要注意清除敏感数据时要考虑到文件或许被移动或改名而存在于其他路径的状况。

### Task. Conclusion

#### `🧑‍💻Every` 写字！

1. 作为作业的终点，请在团队博客上提交一篇博客，内容至少包括：

   - 团队的代码仓库地址；
   - 团队完成 **Task. HotFix!** 后新建的代码仓库地址；
   - 需要说明的状况。

2. 同时，推荐团队完成以下内容，这部分内容在之后的团队项目博客作业（具体来说是项目展示部分）中仍然需要完成，因此现在完成可以减少之后的负担：

   - 团队选定的 DevOps 技术选型以及选择的原因、使用相关技术的方式；团队对代码仓库的管理、对这方面工作的安排；
   - 团队对于代码审查的考虑，代码发布的流程；
   - 在代码管理中，团队会遇到哪些风险，如何解决这些风险；

3. 最后，如果确实有所心得，希望团队能记载过程中种种实践和讨论的所得，梳理一下，这些心得可能包括：

   - 这次实践中遇到了哪些问题，如何解决和避免；
   - 版本管理系统的协作中，除了使用软件之外，还需考虑哪些内容：例如，流程、规范等；
   - 适用于你们团队的版本管理系统协作规范；
   - 对具体软件操作的理解：例如上面提及的 `git merge `和 `git rebase`；

   等等，这些内容不一定要留在博客中，更不参与计分，但一定会成为团队实践和个人软工路上的宝贵财富。

> Ver.4 by @KumaXX 